{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://ngx-image-cropper/lib/interfaces/move-start.interface.ts","ng://ngx-image-cropper/lib/utils/resize.utils.ts","ng://ngx-image-cropper/lib/services/crop.service.ts","ng://ngx-image-cropper/lib/interfaces/cropper.settings.ts","ng://ngx-image-cropper/lib/utils/exif.utils.ts","ng://ngx-image-cropper/lib/services/load-image.service.ts","ng://ngx-image-cropper/lib/services/cropper-position.service.ts","ng://ngx-image-cropper/lib/component/image-cropper.component.ts","ng://ngx-image-cropper/lib/utils/keyboard.utils.ts","ng://ngx-image-cropper/lib/image-cropper.module.ts","ng://ngx-image-cropper/lib/utils/blob.utils.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__read","o","m","r","ar","error","MoveTypes","Move","Resize","Pinch","resizeCanvas","canvas","width","height","width_source","height_source","ratio_w","Math","round","ratio_h","ratio_w_half","ceil","ratio_h_half","ctx","getContext","img","getImageData","img2","createImageData","data","data2","j","x2","center_y","weight","weights","weights_alpha","gx_r","gx_g","gx_b","gx_a","xx_start","floor","yy_start","xx_stop","yy_stop","min","yy","dy","abs","center_x","w0","xx","dx","w","sqrt","pos_x","putImageData","CropService","crop","sourceImage","loadedImage","cropper","settings","imagePosition","getImagePosition","x1","y2","y1","cropCanvas","document","createElement","backgroundColor","fillStyle","fillRect","scaleX","transform","scale","flipH","scaleY","flipV","transformedImage","transformed","setTransform","size","translate","rotate","PI","drawImage","image","output","cropperPosition","containWithinAspectRatio","offsetImagePosition","getOffsetImagePosition","resizeRatio","getResizeRatio","maintainAspectRatio","aspectRatio","base64","toDataURL","format","getQuality","sourceImageElement","nativeElement","ratio","offsetWidth","out","max","offsetX","offsetY","canvasRotation","exifTransform","original","ratioWidth","resizeToWidth","ratioHeight","resizeToHeight","ratios","Array","concat","__spread","onlyScaleDown","imageQuality","Injectable","args","providedIn","CropperSettings","cropperMinWidth","cropperMinHeight","cropperMaxHeight","cropperMaxWidth","cropperStaticWidth","cropperStaticHeight","initialStepSize","roundCropper","autoCrop","undefined","hideResizeSquares","alignImage","cropperScaledMinWidth","cropperScaledMinHeight","cropperScaledMaxWidth","cropperScaledMaxHeight","stepSize","setOptions","options","_this","keys","filter","k","forEach","validateOptions","setOptionsFromChanges","changes","currentValue","Error","getTransformationsFromExifData","exifRotationOrBase64Image","imageBase64","view","DataView","replace","binaryString","atob","len","bytes","Uint8Array","charCodeAt","buffer","base64ToArrayBuffer","getUint16","byteLength","offset","marker","getUint32","little","tags","getExifRotation","flip","LoadImageService","autoRotateSupported","Image","onload","supported","src","loadImageFile","file","cropperSettings","fileReader","FileReader","event","loadImage","target","type","catch","readAsDataURL","imageType","isValidImageType","loadBase64Image","test","loadImageFromURL","url","onerror","context","crossOrigin","originalImage","originalBase64","res","transformImageBase64","_a","complete","naturalWidth","naturalHeight","transformLoadedImage","originalSize","transformedSize","getTransformedSize","transformedBase64","loadImageFromBase64","minWidthToContain","minHeightToContain","CropperPositionService","resetCropperPosition","offsetHeight","cropperWidth","cropperHeight","cropperHeightWithAspectRatio","cropperWidthWithAspectRatio","move","moveStart","diffX","getClientX","clientX","diffY","getClientY","clientY","resize","maxSize","moveX","moveY","position","newWidth","newHeight","checkAspectRatio","overflowX","overflowY","overflowX1","overflowX2","overflowY1","overflowY2","touches","ImageCropperComponent","cropService","cropperPositionService","loadImageService","sanitizer","cd","Hammer","window","setImageMaxSizeRetries","marginLeft","moveTypes","imageVisible","disabled","imageCropped","EventEmitter","startCropImage","imageLoaded","cropperReady","loadImageFailed","reset","ngOnChanges","onChangesUpdateSettings","onChangesInputImage","setLoadedImage","err","loadImageError","setMaxSize","setCropperScaledMinSize","setCropperScaledMaxSize","checkCropperPosition","doAutoCrop","markForCheck","setCssTransform","imageChangedEvent","imageURL","imageFile","isValidImageChangedEvent","files","safeTransformStyle","bypassSecurityTrustStyle","ngOnInit","activatePinchGesture","safeImgDataUrl","active","bypassSecurityTrustResourceUrl","console","emit","imageLoadedInView","setTimeout","checkImageMaxSizeRecursively","sourceImageLoaded","onResize","resizeCropperPosition","hammer","wrapper","get","set","enable","on","onPinch","bind","pinchStop","startPinch","isDevMode","warn","keyboardAccess","changeKeyboardStepSize","keyboardMoveCropper","key","includes","moveType","shiftKey","altKey","getInvertedPositionForKey","getPositionForKey","moveEvent","getEventForKey","preventDefault","stopPropagation","startMove","moveImg","moveStop","detectChanges","setCropperScaledMinWidth","setCropperScaledMinHeight","maintainSize","Component","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","DomSanitizer","ChangeDetectorRef","ViewChild","static","Input","HostBinding","Output","HostListener","ImageCropperModule","NgModule","imports","CommonModule","declarations","exports","base64Image","split","byteString","ab","ArrayBuffer","ia","Blob"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export interface MoveStart {\n  active: boolean;\n  type: MoveTypes | null;\n  position: string | null;\n  x1: number;\n  y1: number;\n  x2: number;\n  y2: number;\n  clientX: number;\n  clientY: number;\n}\n\nexport enum MoveTypes {\n  Move = 'move',\n  Resize = 'resize',\n  Pinch = 'pinch'\n}\n","/*\n * Hermite resize - fast image resize/resample using Hermite filter.\n * https://github.com/viliusle/Hermite-resize\n */\n\nexport function resizeCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n  const width_source = canvas.width;\n  const height_source = canvas.height;\n  width = Math.round(width);\n  height = Math.round(height);\n\n  const ratio_w = width_source / width;\n  const ratio_h = height_source / height;\n  const ratio_w_half = Math.ceil(ratio_w / 2);\n  const ratio_h_half = Math.ceil(ratio_h / 2);\n\n  const ctx = canvas.getContext('2d');\n  if (ctx) {\n    const img = ctx.getImageData(0, 0, width_source, height_source);\n    const img2 = ctx.createImageData(width, height);\n    const data = img.data;\n    const data2 = img2.data;\n\n    for (let j = 0; j < height; j++) {\n      for (let i = 0; i < width; i++) {\n        const x2 = (i + j * width) * 4;\n        const center_y = j * ratio_h;\n        let weight = 0;\n        let weights = 0;\n        let weights_alpha = 0;\n        let gx_r = 0;\n        let gx_g = 0;\n        let gx_b = 0;\n        let gx_a = 0;\n\n        const xx_start = Math.floor(i * ratio_w);\n        const yy_start = Math.floor(j * ratio_h);\n        let xx_stop = Math.ceil((i + 1) * ratio_w);\n        let yy_stop = Math.ceil((j + 1) * ratio_h);\n        xx_stop = Math.min(xx_stop, width_source);\n        yy_stop = Math.min(yy_stop, height_source);\n\n        for (let yy = yy_start; yy < yy_stop; yy++) {\n          const dy = Math.abs(center_y - yy) / ratio_h_half;\n          const center_x = i * ratio_w;\n          const w0 = dy * dy; //pre-calc part of w\n          for (let xx = xx_start; xx < xx_stop; xx++) {\n            const dx = Math.abs(center_x - xx) / ratio_w_half;\n            const w = Math.sqrt(w0 + dx * dx);\n            if (w >= 1) {\n              //pixel too far\n              continue;\n            }\n            //hermite filter\n            weight = 2 * w * w * w - 3 * w * w + 1;\n            const pos_x = 4 * (xx + yy * width_source);\n            //alpha\n            gx_a += weight * data[pos_x + 3];\n            weights_alpha += weight;\n            //colors\n            if (data[pos_x + 3] < 255)\n              weight = weight * data[pos_x + 3] / 250;\n            gx_r += weight * data[pos_x];\n            gx_g += weight * data[pos_x + 1];\n            gx_b += weight * data[pos_x + 2];\n            weights += weight;\n          }\n        }\n        data2[x2] = gx_r / weights;\n        data2[x2 + 1] = gx_g / weights;\n        data2[x2 + 2] = gx_b / weights;\n        data2[x2 + 3] = gx_a / weights_alpha;\n      }\n    }\n\n\n    canvas.width = width;\n    canvas.height = height;\n\n    //draw\n    ctx.putImageData(img2, 0, 0);\n  }\n}\n","import { ElementRef, Injectable } from '@angular/core';\nimport { CropperSettings } from '../interfaces/cropper.settings';\nimport { CropperPosition, ImageCroppedEvent, LoadedImage } from '../interfaces';\nimport { resizeCanvas } from '../utils/resize.utils';\n\n@Injectable({providedIn: 'root'})\nexport class CropService {\n\n  crop(sourceImage: ElementRef, loadedImage: LoadedImage, cropper: CropperPosition, settings: CropperSettings): ImageCroppedEvent | null {\n    const imagePosition = this.getImagePosition(sourceImage, loadedImage, cropper, settings);\n    const width = imagePosition.x2 - imagePosition.x1;\n    const height = imagePosition.y2 - imagePosition.y1;\n    const cropCanvas = document.createElement('canvas') as HTMLCanvasElement;\n    cropCanvas.width = width;\n    cropCanvas.height = height;\n\n    const ctx = cropCanvas.getContext('2d');\n    if (!ctx) {\n      return;\n    }\n    if (settings.backgroundColor != null) {\n      ctx.fillStyle = settings.backgroundColor;\n      ctx.fillRect(0, 0, width, height);\n    }\n\n    const scaleX = (settings.transform.scale || 1) * (settings.transform.flipH ? -1 : 1);\n    const scaleY = (settings.transform.scale || 1) * (settings.transform.flipV ? -1 : 1);\n\n    const transformedImage = loadedImage.transformed;\n    ctx.setTransform(scaleX, 0, 0, scaleY, transformedImage.size.width / 2, transformedImage.size.height / 2);\n    ctx.translate(-imagePosition.x1 / scaleX, -imagePosition.y1 / scaleY);\n    ctx.rotate((settings.transform.rotate || 0) * Math.PI / 180);\n    ctx.drawImage(transformedImage.image, -transformedImage.size.width / 2, -transformedImage.size.height / 2);\n\n    const output: ImageCroppedEvent = {\n      width, height,\n      imagePosition,\n      cropperPosition: {...cropper}\n    };\n    if (settings.containWithinAspectRatio) {\n      output.offsetImagePosition = this.getOffsetImagePosition(sourceImage, loadedImage, cropper, settings);\n    }\n    const resizeRatio = this.getResizeRatio(width, height, settings);\n    if (resizeRatio !== 1) {\n      output.width = Math.round(width * resizeRatio);\n      output.height = settings.maintainAspectRatio\n        ? Math.round(output.width / settings.aspectRatio)\n        : Math.round(height * resizeRatio);\n      resizeCanvas(cropCanvas, output.width, output.height);\n    }\n    output.base64 = cropCanvas.toDataURL('image/' + settings.format, this.getQuality(settings));\n    return output;\n  }\n\n  private getImagePosition(sourceImage: ElementRef, loadedImage: LoadedImage, cropper: CropperPosition, settings: CropperSettings): CropperPosition {\n    const sourceImageElement = sourceImage.nativeElement;\n    const ratio = loadedImage.transformed.size.width / sourceImageElement.offsetWidth;\n\n    const out: CropperPosition = {\n      x1: Math.round(cropper.x1 * ratio),\n      y1: Math.round(cropper.y1 * ratio),\n      x2: Math.round(cropper.x2 * ratio),\n      y2: Math.round(cropper.y2 * ratio)\n    };\n\n    if (!settings.containWithinAspectRatio) {\n      out.x1 = Math.max(out.x1, 0);\n      out.y1 = Math.max(out.y1, 0);\n      out.x2 = Math.min(out.x2, loadedImage.transformed.size.width);\n      out.y2 = Math.min(out.y2, loadedImage.transformed.size.height);\n    }\n\n    return out;\n  }\n\n  private getOffsetImagePosition(sourceImage: ElementRef, loadedImage: LoadedImage, cropper: CropperPosition, settings: CropperSettings): CropperPosition {\n    const canvasRotation = settings.canvasRotation + loadedImage.exifTransform.rotate;\n    const sourceImageElement = sourceImage.nativeElement;\n    const ratio = loadedImage.transformed.size.width / sourceImageElement.offsetWidth;\n    let offsetX: number;\n    let offsetY: number;\n\n    if (canvasRotation % 2) {\n      offsetX = (loadedImage.transformed.size.width - loadedImage.original.size.height) / 2;\n      offsetY = (loadedImage.transformed.size.height - loadedImage.original.size.width) / 2;\n    } else {\n      offsetX = (loadedImage.transformed.size.width - loadedImage.original.size.width) / 2;\n      offsetY = (loadedImage.transformed.size.height - loadedImage.original.size.height) / 2;\n    }\n\n    const out: CropperPosition = {\n      x1: Math.round(cropper.x1 * ratio) - offsetX,\n      y1: Math.round(cropper.y1 * ratio) - offsetY,\n      x2: Math.round(cropper.x2 * ratio) - offsetX,\n      y2: Math.round(cropper.y2 * ratio) - offsetY\n    };\n\n    if (!settings.containWithinAspectRatio) {\n      out.x1 = Math.max(out.x1, 0);\n      out.y1 = Math.max(out.y1, 0);\n      out.x2 = Math.min(out.x2, loadedImage.transformed.size.width);\n      out.y2 = Math.min(out.y2, loadedImage.transformed.size.height);\n    }\n\n    return out;\n  }\n\n  getResizeRatio(width: number, height: number, settings: CropperSettings): number {\n    const ratioWidth = settings.resizeToWidth / width;\n    const ratioHeight = settings.resizeToHeight / height;\n    const ratios = new Array<number>();\n\n    if (settings.resizeToWidth > 0) {\n      ratios.push(ratioWidth);\n    }\n    if (settings.resizeToHeight > 0) {\n      ratios.push(ratioHeight);\n    }\n\n    const result = ratios.length === 0 ? 1 : Math.min(...ratios);\n\n    if (result > 1 && !settings.onlyScaleDown) {\n      return result;\n    }\n    return Math.min(result, 1);\n  }\n\n  getQuality(settings: CropperSettings): number {\n    return Math.min(1, Math.max(0, settings.imageQuality / 100));\n  }\n}\n","import { CropperOptions, OutputFormat } from './cropper-options.interface';\nimport { ImageTransform } from './image-transform.interface';\nimport { SimpleChanges } from '@angular/core';\n\nexport class CropperSettings {\n\n  // From options\n  format: OutputFormat = 'png';\n  maintainAspectRatio = true;\n  transform: ImageTransform = {};\n  aspectRatio = 1;\n  resizeToWidth = 0;\n  resizeToHeight = 0;\n  cropperMinWidth = 0;\n  cropperMinHeight = 0;\n  cropperMaxHeight = 0;\n  cropperMaxWidth = 0;\n  cropperStaticWidth = 0;\n  cropperStaticHeight = 0;\n  canvasRotation = 0;\n  initialStepSize = 3;\n  roundCropper = false;\n  onlyScaleDown = false;\n  imageQuality = 92;\n  autoCrop = true;\n  backgroundColor: string = undefined;\n  containWithinAspectRatio = false;\n  hideResizeSquares = false;\n  alignImage: 'left' | 'center' = 'center';\n\n  // Internal\n  cropperScaledMinWidth = 20;\n  cropperScaledMinHeight = 20;\n  cropperScaledMaxWidth = 20;\n  cropperScaledMaxHeight = 20;\n  stepSize = this.initialStepSize;\n\n  setOptions(options: Partial<CropperOptions>): void {\n    Object.keys(options)\n      .filter((k) => k in this)\n      .forEach((k) => this[k] = options[k]);\n    this.validateOptions();\n  }\n\n  setOptionsFromChanges(changes: SimpleChanges): void {\n    Object.keys(changes)\n      .filter((k) => k in this)\n      .forEach((k) => this[k] = changes[k].currentValue);\n    this.validateOptions();\n  }\n\n  private validateOptions(): void {\n    if (this.maintainAspectRatio && !this.aspectRatio) {\n      throw new Error('`aspectRatio` should > 0 when `maintainAspectRatio` is enabled');\n    }\n  }\n}\n","import { ExifTransform } from '../interfaces/exif-transform.interface';\n\n// Black 2x1 JPEG, with the following meta information set:\n// - EXIF Orientation: 6 (Rotated 90° CCW)\n// Source: https://github.com/blueimp/JavaScript-Load-Image\nconst testAutoOrientationImageURL =\n  'data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAA' +\n  'AAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA' +\n  'QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQE' +\n  'BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/x' +\n  'ABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAA' +\n  'AAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==';\n\nexport function supportsAutomaticRotation(): Promise<boolean> {\n  return new Promise((resolve) => {\n    const img = new Image();\n    img.onload = () => {\n      // Check if browser supports automatic image orientation:\n      const supported = img.width === 1 && img.height === 2;\n      resolve(supported);\n    };\n    img.src = testAutoOrientationImageURL;\n  });\n}\n\nexport function getTransformationsFromExifData(exifRotationOrBase64Image: number | string): ExifTransform {\n  if (typeof exifRotationOrBase64Image === 'string') {\n    exifRotationOrBase64Image = getExifRotation(exifRotationOrBase64Image);\n  }\n  switch (exifRotationOrBase64Image) {\n    case 2:\n      return {rotate: 0, flip: true};\n    case 3:\n      return {rotate: 2, flip: false};\n    case 4:\n      return {rotate: 2, flip: true};\n    case 5:\n      return {rotate: 1, flip: true};\n    case 6:\n      return {rotate: 1, flip: false};\n    case 7:\n      return {rotate: 3, flip: true};\n    case 8:\n      return {rotate: 3, flip: false};\n    default:\n      return {rotate: 0, flip: false};\n  }\n}\n\nfunction getExifRotation(imageBase64: string): number {\n  const view = new DataView(base64ToArrayBuffer(imageBase64));\n  if (view.getUint16(0, false) != 0xFFD8) {\n    return -2;\n  }\n  const length = view.byteLength;\n  let offset = 2;\n  while (offset < length) {\n    if (view.getUint16(offset + 2, false) <= 8) return -1;\n    const marker = view.getUint16(offset, false);\n    offset += 2;\n    if (marker == 0xFFE1) {\n      if (view.getUint32(offset += 2, false) != 0x45786966) {\n        return -1;\n      }\n\n      const little = view.getUint16(offset += 6, false) == 0x4949;\n      offset += view.getUint32(offset + 4, little);\n      const tags = view.getUint16(offset, little);\n      offset += 2;\n      for (let i = 0; i < tags; i++) {\n        if (view.getUint16(offset + (i * 12), little) == 0x0112) {\n          return view.getUint16(offset + (i * 12) + 8, little);\n        }\n      }\n    } else if ((marker & 0xFF00) != 0xFF00) {\n      break;\n    } else {\n      offset += view.getUint16(offset, false);\n    }\n  }\n  return -1;\n}\n\nfunction base64ToArrayBuffer(imageBase64: string) {\n  imageBase64 = imageBase64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n  const binaryString = atob(imageBase64);\n  const len = binaryString.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) {\n    bytes[i] = binaryString.charCodeAt(i);\n  }\n  return bytes.buffer;\n}\n","import { Injectable } from '@angular/core';\nimport { Dimensions, LoadedImage } from '../interfaces';\nimport { CropperSettings } from '../interfaces/cropper.settings';\nimport { ExifTransform } from '../interfaces/exif-transform.interface';\nimport { getTransformationsFromExifData, supportsAutomaticRotation } from '../utils/exif.utils';\n\ninterface LoadImageBase64 {\n  originalImage: HTMLImageElement;\n  originalBase64: string;\n}\n\n@Injectable({providedIn: 'root'})\nexport class LoadImageService {\n\n  private autoRotateSupported: Promise<boolean> = supportsAutomaticRotation();\n\n  loadImageFile(file: File, cropperSettings: CropperSettings): Promise<LoadedImage> {\n    return new Promise((resolve, reject) => {\n      const fileReader = new FileReader();\n      fileReader.onload = (event: any) => {\n        this.loadImage(event.target.result, file.type, cropperSettings)\n          .then(resolve)\n          .catch(reject);\n      };\n      fileReader.readAsDataURL(file);\n    });\n  }\n\n  private loadImage(imageBase64: string, imageType: string, cropperSettings: CropperSettings): Promise<LoadedImage> {\n    if (!this.isValidImageType(imageType)) {\n      return Promise.reject(new Error('Invalid image type'));\n    }\n    return this.loadBase64Image(imageBase64, cropperSettings);\n  }\n\n  private isValidImageType(type: string): boolean {\n    return /image\\/(png|jpg|jpeg|bmp|gif|tiff|webp)/.test(type);\n  }\n\n  loadImageFromURL(url: string, cropperSettings: CropperSettings): Promise<LoadedImage> {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onerror = () => reject;\n      img.onload = () => {\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        canvas.width = img.width;\n        canvas.height = img.height;\n        context.drawImage(img, 0, 0);\n        this.loadBase64Image(canvas.toDataURL(), cropperSettings).then(resolve);\n      };\n      img.crossOrigin = 'anonymous';\n      img.src = url;\n    });\n  }\n\n  loadBase64Image(imageBase64: string, cropperSettings: CropperSettings): Promise<LoadedImage> {\n    return new Promise<LoadImageBase64>((resolve, reject) => {\n      const originalImage = new Image();\n      originalImage.onload = () => resolve({\n        originalImage,\n        originalBase64: imageBase64\n      });\n      originalImage.onerror = reject;\n      originalImage.src = imageBase64;\n    }).then((res: LoadImageBase64) => this.transformImageBase64(res, cropperSettings));\n  }\n\n  private async transformImageBase64(res: LoadImageBase64, cropperSettings: CropperSettings): Promise<LoadedImage> {\n    const autoRotate = await this.autoRotateSupported;\n    const exifTransform = await getTransformationsFromExifData(autoRotate ? -1 : res.originalBase64);\n    if (!res.originalImage || !res.originalImage.complete) {\n      return Promise.reject(new Error('No image loaded'));\n    }\n    const loadedImage = {\n      original: {\n        base64: res.originalBase64,\n        image: res.originalImage,\n        size: {\n          width: res.originalImage.naturalWidth,\n          height: res.originalImage.naturalHeight\n        }\n      },\n      exifTransform\n    };\n    return this.transformLoadedImage(loadedImage, cropperSettings);\n  }\n\n  async transformLoadedImage(loadedImage: Partial<LoadedImage>, cropperSettings: CropperSettings): Promise<LoadedImage> {\n    const canvasRotation = cropperSettings.canvasRotation + loadedImage.exifTransform.rotate;\n    const originalSize = {\n      width: loadedImage.original.image.naturalWidth,\n      height: loadedImage.original.image.naturalHeight\n    };\n    if (canvasRotation === 0 && !loadedImage.exifTransform.flip && !cropperSettings.containWithinAspectRatio) {\n      return {\n        original: {\n          base64: loadedImage.original.base64,\n          image: loadedImage.original.image,\n          size: {...originalSize}\n        },\n        transformed: {\n          base64: loadedImage.original.base64,\n          image: loadedImage.original.image,\n          size: {...originalSize}\n        },\n        exifTransform: loadedImage.exifTransform\n      };\n    }\n\n    const transformedSize = this.getTransformedSize(originalSize, loadedImage.exifTransform, cropperSettings);\n    const canvas = document.createElement('canvas');\n    canvas.width = transformedSize.width;\n    canvas.height = transformedSize.height;\n    const ctx = canvas.getContext('2d');\n    ctx.setTransform(\n      loadedImage.exifTransform.flip ? -1 : 1,\n      0,\n      0,\n      1,\n      canvas.width / 2,\n      canvas.height / 2\n    );\n    ctx.rotate(Math.PI * (canvasRotation / 2));\n    ctx.drawImage(\n      loadedImage.original.image,\n      -originalSize.width / 2,\n      -originalSize.height / 2\n    );\n    const transformedBase64 = canvas.toDataURL();\n    const transformedImage = await this.loadImageFromBase64(transformedBase64);\n    return {\n      original: {\n        base64: loadedImage.original.base64,\n        image: loadedImage.original.image,\n        size: {...originalSize}\n      },\n      transformed: {\n        base64: transformedBase64,\n        image: transformedImage,\n        size: {\n          width: transformedImage.width,\n          height: transformedImage.height\n        }\n      },\n      exifTransform: loadedImage.exifTransform\n    };\n  }\n\n  private loadImageFromBase64(imageBase64: string): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>(((resolve, reject) => {\n      const image = new Image();\n      image.onload = () => resolve(image);\n      image.onerror = reject;\n      image.src = imageBase64;\n    }));\n  }\n\n  private getTransformedSize(\n    originalSize: { width: number, height: number },\n    exifTransform: ExifTransform,\n    cropperSettings: CropperSettings\n  ): Dimensions {\n    const canvasRotation = cropperSettings.canvasRotation + exifTransform.rotate;\n    if (cropperSettings.containWithinAspectRatio) {\n      if (canvasRotation % 2) {\n        const minWidthToContain = originalSize.width * cropperSettings.aspectRatio;\n        const minHeightToContain = originalSize.height / cropperSettings.aspectRatio;\n        return {\n          width: Math.max(originalSize.height, minWidthToContain),\n          height: Math.max(originalSize.width, minHeightToContain)\n        };\n      } else {\n        const minWidthToContain = originalSize.height * cropperSettings.aspectRatio;\n        const minHeightToContain = originalSize.width / cropperSettings.aspectRatio;\n        return {\n          width: Math.max(originalSize.width, minWidthToContain),\n          height: Math.max(originalSize.height, minHeightToContain)\n        };\n      }\n    }\n\n    if (canvasRotation % 2) {\n      return {\n        height: originalSize.width,\n        width: originalSize.height\n      };\n    }\n    return {\n      width: originalSize.width,\n      height: originalSize.height\n    };\n  }\n}\n","import { ElementRef, Injectable } from '@angular/core';\nimport { CropperPosition, Dimensions, MoveStart } from '../interfaces';\nimport { CropperSettings } from '../interfaces/cropper.settings';\n\n@Injectable({providedIn: 'root'})\nexport class CropperPositionService {\n\n  resetCropperPosition(sourceImage: ElementRef, cropperPosition: CropperPosition, settings: CropperSettings): void {\n    if (!sourceImage?.nativeElement) {\n      return;\n    }\n    const sourceImageElement = sourceImage.nativeElement;\n    if (settings.cropperStaticHeight && settings.cropperStaticWidth) {\n      cropperPosition.x1 = 0;\n      cropperPosition.x2 = sourceImageElement.offsetWidth > settings.cropperStaticWidth ?\n        settings.cropperStaticWidth : sourceImageElement.offsetWidth;\n      cropperPosition.y1 = 0;\n      cropperPosition.y2 = sourceImageElement.offsetHeight > settings.cropperStaticHeight ?\n        settings.cropperStaticHeight : sourceImageElement.offsetHeight;\n    } else {\n      const cropperWidth = Math.min(settings.cropperScaledMaxWidth, sourceImageElement.offsetWidth);\n      const cropperHeight = Math.min(settings.cropperScaledMaxHeight, sourceImageElement.offsetHeight);\n      if (!settings.maintainAspectRatio) {\n        cropperPosition.x1 = 0;\n        cropperPosition.x2 = cropperWidth;\n        cropperPosition.y1 = 0;\n        cropperPosition.y2 = cropperHeight;\n      } else if (cropperWidth / settings.aspectRatio < cropperHeight) {\n        cropperPosition.x1 = 0;\n        cropperPosition.x2 = cropperWidth;\n        const cropperHeightWithAspectRatio = cropperWidth / settings.aspectRatio;\n        cropperPosition.y1 = (sourceImageElement.offsetHeight - cropperHeightWithAspectRatio) / 2;\n        cropperPosition.y2 = cropperPosition.y1 + cropperHeightWithAspectRatio;\n      } else {\n        cropperPosition.y1 = 0;\n        cropperPosition.y2 = cropperHeight;\n        const cropperWidthWithAspectRatio = cropperHeight * settings.aspectRatio;\n        cropperPosition.x1 = (sourceImageElement.offsetWidth - cropperWidthWithAspectRatio) / 2;\n        cropperPosition.x2 = cropperPosition.x1 + cropperWidthWithAspectRatio;\n      }\n    }\n  }\n\n  move(event: any, moveStart: MoveStart, cropperPosition: CropperPosition) {\n    const diffX = this.getClientX(event) - moveStart.clientX;\n    const diffY = this.getClientY(event) - moveStart.clientY;\n\n    cropperPosition.x1 = moveStart.x1 + diffX;\n    cropperPosition.y1 = moveStart.y1 + diffY;\n    cropperPosition.x2 = moveStart.x2 + diffX;\n    cropperPosition.y2 = moveStart.y2 + diffY;\n  }\n\n  resize(event: any, moveStart: MoveStart, cropperPosition: CropperPosition, maxSize: Dimensions, settings: CropperSettings): void {\n    const moveX = this.getClientX(event) - moveStart.clientX;\n    const moveY = this.getClientY(event) - moveStart.clientY;\n    switch (moveStart.position) {\n      case 'left':\n        cropperPosition.x1 = Math.min(Math.max(moveStart.x1 + moveX, cropperPosition.x2 - settings.cropperScaledMaxWidth),\n          cropperPosition.x2 - settings.cropperScaledMinWidth);\n        break;\n      case 'topleft':\n        cropperPosition.x1 = Math.min(Math.max(moveStart.x1 + moveX, cropperPosition.x2 - settings.cropperScaledMaxWidth),\n          cropperPosition.x2 - settings.cropperScaledMinWidth);\n        cropperPosition.y1 = Math.min(Math.max(moveStart.y1 + moveY, cropperPosition.y2 - settings.cropperScaledMaxHeight),\n          cropperPosition.y2 - settings.cropperScaledMinHeight);\n        break;\n      case 'top':\n        cropperPosition.y1 = Math.min(Math.max(moveStart.y1 + moveY, cropperPosition.y2 - settings.cropperScaledMaxHeight),\n          cropperPosition.y2 - settings.cropperScaledMinHeight);\n        break;\n      case 'topright':\n        cropperPosition.x2 = Math.max(Math.min(moveStart.x2 + moveX, cropperPosition.x1 + settings.cropperScaledMaxWidth),\n          cropperPosition.x1 + settings.cropperScaledMinWidth);\n        cropperPosition.y1 = Math.min(Math.max(moveStart.y1 + moveY, cropperPosition.y2 - settings.cropperScaledMaxHeight),\n          cropperPosition.y2 - settings.cropperScaledMinHeight);\n        break;\n      case 'right':\n        cropperPosition.x2 = Math.max(Math.min(moveStart.x2 + moveX, cropperPosition.x1 + settings.cropperScaledMaxWidth),\n          cropperPosition.x1 + settings.cropperScaledMinWidth);\n        break;\n      case 'bottomright':\n        cropperPosition.x2 = Math.max(Math.min(moveStart.x2 + moveX, cropperPosition.x1 + settings.cropperScaledMaxWidth),\n          cropperPosition.x1 + settings.cropperScaledMinWidth);\n        cropperPosition.y2 = Math.max(Math.min(moveStart.y2 + moveY, cropperPosition.y1 + settings.cropperScaledMaxHeight),\n          cropperPosition.y1 + settings.cropperScaledMinHeight);\n        break;\n      case 'bottom':\n        cropperPosition.y2 = Math.max(Math.min(moveStart.y2 + moveY, cropperPosition.y1 + settings.cropperScaledMaxHeight),\n          cropperPosition.y1 + settings.cropperScaledMinHeight);\n        break;\n      case 'bottomleft':\n        cropperPosition.x1 = Math.min(Math.max(moveStart.x1 + moveX, cropperPosition.x2 - settings.cropperScaledMaxWidth),\n          cropperPosition.x2 - settings.cropperScaledMinWidth);\n        cropperPosition.y2 = Math.max(Math.min(moveStart.y2 + moveY, cropperPosition.y1 + settings.cropperScaledMaxHeight),\n          cropperPosition.y1 + settings.cropperScaledMinHeight);\n        break;\n      case 'center':\n        const scale = event.scale;\n        const newWidth = Math.min(\n          Math.max(settings.cropperScaledMinWidth, (Math.abs(moveStart.x2 - moveStart.x1)) * scale),\n          settings.cropperScaledMaxWidth);\n        const newHeight = Math.min(\n          Math.max(settings.cropperScaledMinHeight, (Math.abs(moveStart.y2 - moveStart.y1)) * scale),\n          settings.cropperScaledMaxHeight);\n        cropperPosition.x1 = moveStart.clientX - newWidth / 2;\n        cropperPosition.x2 = moveStart.clientX + newWidth / 2;\n        cropperPosition.y1 = moveStart.clientY - newHeight / 2;\n        cropperPosition.y2 = moveStart.clientY + newHeight / 2;\n        if (cropperPosition.x1 < 0) {\n          cropperPosition.x2 -= cropperPosition.x1;\n          cropperPosition.x1 = 0;\n        } else if (cropperPosition.x2 > maxSize.width) {\n          cropperPosition.x1 -= (cropperPosition.x2 - maxSize.width);\n          cropperPosition.x2 = maxSize.width;\n        }\n        if (cropperPosition.y1 < 0) {\n          cropperPosition.y2 -= cropperPosition.y1;\n          cropperPosition.y1 = 0;\n        } else if (cropperPosition.y2 > maxSize.height) {\n          cropperPosition.y1 -= (cropperPosition.y2 - maxSize.height);\n          cropperPosition.y2 = maxSize.height;\n        }\n        break;\n    }\n\n    if (settings.maintainAspectRatio) {\n      this.checkAspectRatio(moveStart.position, cropperPosition, maxSize, settings);\n    }\n  }\n\n  checkAspectRatio(position: string, cropperPosition: CropperPosition, maxSize: Dimensions, settings: CropperSettings): void {\n    let overflowX = 0;\n    let overflowY = 0;\n\n    switch (position) {\n      case 'top':\n        cropperPosition.x2 = cropperPosition.x1 + (cropperPosition.y2 - cropperPosition.y1) * settings.aspectRatio;\n        overflowX = Math.max(cropperPosition.x2 - maxSize.width, 0);\n        overflowY = Math.max(0 - cropperPosition.y1, 0);\n        if (overflowX > 0 || overflowY > 0) {\n          cropperPosition.x2 -= (overflowY * settings.aspectRatio) > overflowX ? (overflowY * settings.aspectRatio) : overflowX;\n          cropperPosition.y1 += (overflowY * settings.aspectRatio) > overflowX ? overflowY : overflowX / settings.aspectRatio;\n        }\n        break;\n      case 'bottom':\n        cropperPosition.x2 = cropperPosition.x1 + (cropperPosition.y2 - cropperPosition.y1) * settings.aspectRatio;\n        overflowX = Math.max(cropperPosition.x2 - maxSize.width, 0);\n        overflowY = Math.max(cropperPosition.y2 - maxSize.height, 0);\n        if (overflowX > 0 || overflowY > 0) {\n          cropperPosition.x2 -= (overflowY * settings.aspectRatio) > overflowX ? (overflowY * settings.aspectRatio) : overflowX;\n          cropperPosition.y2 -= (overflowY * settings.aspectRatio) > overflowX ? overflowY : (overflowX / settings.aspectRatio);\n        }\n        break;\n      case 'topleft':\n        cropperPosition.y1 = cropperPosition.y2 - (cropperPosition.x2 - cropperPosition.x1) / settings.aspectRatio;\n        overflowX = Math.max(0 - cropperPosition.x1, 0);\n        overflowY = Math.max(0 - cropperPosition.y1, 0);\n        if (overflowX > 0 || overflowY > 0) {\n          cropperPosition.x1 += (overflowY * settings.aspectRatio) > overflowX ? (overflowY * settings.aspectRatio) : overflowX;\n          cropperPosition.y1 += (overflowY * settings.aspectRatio) > overflowX ? overflowY : overflowX / settings.aspectRatio;\n        }\n        break;\n      case 'topright':\n        cropperPosition.y1 = cropperPosition.y2 - (cropperPosition.x2 - cropperPosition.x1) / settings.aspectRatio;\n        overflowX = Math.max(cropperPosition.x2 - maxSize.width, 0);\n        overflowY = Math.max(0 - cropperPosition.y1, 0);\n        if (overflowX > 0 || overflowY > 0) {\n          cropperPosition.x2 -= (overflowY * settings.aspectRatio) > overflowX ? (overflowY * settings.aspectRatio) : overflowX;\n          cropperPosition.y1 += (overflowY * settings.aspectRatio) > overflowX ? overflowY : overflowX / settings.aspectRatio;\n        }\n        break;\n      case 'right':\n      case 'bottomright':\n        cropperPosition.y2 = cropperPosition.y1 + (cropperPosition.x2 - cropperPosition.x1) / settings.aspectRatio;\n        overflowX = Math.max(cropperPosition.x2 - maxSize.width, 0);\n        overflowY = Math.max(cropperPosition.y2 - maxSize.height, 0);\n        if (overflowX > 0 || overflowY > 0) {\n          cropperPosition.x2 -= (overflowY * settings.aspectRatio) > overflowX ? (overflowY * settings.aspectRatio) : overflowX;\n          cropperPosition.y2 -= (overflowY * settings.aspectRatio) > overflowX ? overflowY : overflowX / settings.aspectRatio;\n        }\n        break;\n      case 'left':\n      case 'bottomleft':\n        cropperPosition.y2 = cropperPosition.y1 + (cropperPosition.x2 - cropperPosition.x1) / settings.aspectRatio;\n        overflowX = Math.max(0 - cropperPosition.x1, 0);\n        overflowY = Math.max(cropperPosition.y2 - maxSize.height, 0);\n        if (overflowX > 0 || overflowY > 0) {\n          cropperPosition.x1 += (overflowY * settings.aspectRatio) > overflowX ? (overflowY * settings.aspectRatio) : overflowX;\n          cropperPosition.y2 -= (overflowY * settings.aspectRatio) > overflowX ? overflowY : overflowX / settings.aspectRatio;\n        }\n        break;\n      case 'center':\n        cropperPosition.x2 = cropperPosition.x1 + (cropperPosition.y2 - cropperPosition.y1) * settings.aspectRatio;\n        cropperPosition.y2 = cropperPosition.y1 + (cropperPosition.x2 - cropperPosition.x1) / settings.aspectRatio;\n        const overflowX1 = Math.max(0 - cropperPosition.x1, 0);\n        const overflowX2 = Math.max(cropperPosition.x2 - maxSize.width, 0);\n        const overflowY1 = Math.max(cropperPosition.y2 - maxSize.height, 0);\n        const overflowY2 = Math.max(0 - cropperPosition.y1, 0);\n        if (overflowX1 > 0 || overflowX2 > 0 || overflowY1 > 0 || overflowY2 > 0) {\n          cropperPosition.x1 += (overflowY1 * settings.aspectRatio) > overflowX1 ? (overflowY1 * settings.aspectRatio) : overflowX1;\n          cropperPosition.x2 -= (overflowY2 * settings.aspectRatio) > overflowX2 ? (overflowY2 * settings.aspectRatio) : overflowX2;\n          cropperPosition.y1 += (overflowY2 * settings.aspectRatio) > overflowX2 ? overflowY2 : overflowX2 / settings.aspectRatio;\n          cropperPosition.y2 -= (overflowY1 * settings.aspectRatio) > overflowX1 ? overflowY1 : overflowX1 / settings.aspectRatio;\n        }\n        break;\n    }\n  }\n\n  getClientX(event: any): number {\n    return (event.touches && event.touches[0] ? event.touches[0].clientX : event.clientX) || 0;\n  }\n\n  getClientY(event: any): number {\n    return (event.touches && event.touches[0] ? event.touches[0].clientY : event.clientY) || 0;\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  HostBinding,\n  HostListener,\n  Input,\n  isDevMode,\n  OnChanges,\n  OnInit,\n  Output,\n  SimpleChanges,\n  ViewChild\n} from '@angular/core';\nimport { DomSanitizer, SafeStyle, SafeUrl } from '@angular/platform-browser';\nimport { CropperPosition, Dimensions, ImageCroppedEvent, ImageTransform, LoadedImage, MoveStart } from '../interfaces';\nimport { MoveTypes } from '../interfaces/move-start.interface';\nimport { HammerStatic } from '../utils/hammer.utils';\nimport { CropService } from '../services/crop.service';\nimport { CropperSettings } from '../interfaces/cropper.settings';\nimport { LoadImageService } from '../services/load-image.service';\nimport { OutputFormat } from '../interfaces/cropper-options.interface';\nimport { CropperPositionService } from '../services/cropper-position.service';\nimport { getEventForKey, getInvertedPositionForKey, getPositionForKey } from '../utils/keyboard.utils';\n\n@Component({\n  selector: 'image-cropper',\n  templateUrl: './image-cropper.component.html',\n  styleUrls: ['./image-cropper.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ImageCropperComponent implements OnChanges, OnInit {\n  private Hammer: HammerStatic = typeof window !== 'undefined'\n    ? (window as any).Hammer as HammerStatic\n    : null;\n  private settings = new CropperSettings();\n  private setImageMaxSizeRetries = 0;\n  private moveStart: MoveStart;\n  private loadedImage: LoadedImage;\n\n  safeImgDataUrl: SafeUrl | string;\n  safeTransformStyle: SafeStyle | string;\n  marginLeft: SafeStyle | string = '0px';\n  maxSize: Dimensions;\n  moveTypes = MoveTypes;\n  imageVisible = false;\n\n  @ViewChild('wrapper', {static: true}) wrapper: ElementRef<HTMLDivElement>;\n  @ViewChild('sourceImage', {static: false}) sourceImage: ElementRef<HTMLDivElement>;\n\n  @Input() imageChangedEvent: any;\n  @Input() imageURL: string;\n  @Input() imageBase64: string;\n  @Input() imageFile: File;\n\n  @Input() format: OutputFormat = this.settings.format;\n  @Input() transform: ImageTransform = {};\n  @Input() maintainAspectRatio = this.settings.maintainAspectRatio;\n  @Input() aspectRatio = this.settings.aspectRatio;\n  @Input() resizeToWidth = this.settings.resizeToWidth;\n  @Input() resizeToHeight = this.settings.resizeToHeight;\n  @Input() cropperMinWidth = this.settings.cropperMinWidth;\n  @Input() cropperMinHeight = this.settings.cropperMinHeight;\n  @Input() cropperMaxHeight = this.settings.cropperMaxHeight;\n  @Input() cropperMaxWidth = this.settings.cropperMaxWidth;\n  @Input() cropperStaticWidth = this.settings.cropperStaticWidth;\n  @Input() cropperStaticHeight = this.settings.cropperStaticHeight;\n  @Input() canvasRotation = this.settings.canvasRotation;\n  @Input() initialStepSize = this.settings.initialStepSize;\n  @Input() roundCropper = this.settings.roundCropper;\n  @Input() onlyScaleDown = this.settings.onlyScaleDown;\n  @Input() imageQuality = this.settings.imageQuality;\n  @Input() autoCrop = this.settings.autoCrop;\n  @Input() backgroundColor = this.settings.backgroundColor;\n  @Input() containWithinAspectRatio = this.settings.containWithinAspectRatio;\n  @Input() hideResizeSquares = this.settings.hideResizeSquares;\n  @Input() cropper: CropperPosition = {\n    x1: -100,\n    y1: -100,\n    x2: 10000,\n    y2: 10000\n  };\n  @HostBinding('style.text-align')\n  @Input() alignImage: 'left' | 'center' = this.settings.alignImage;\n  @HostBinding('class.disabled')\n  @Input() disabled = false;\n\n  @Output() imageCropped = new EventEmitter<ImageCroppedEvent>();\n  @Output() startCropImage = new EventEmitter<void>();\n  @Output() imageLoaded = new EventEmitter<LoadedImage>();\n  @Output() cropperReady = new EventEmitter<Dimensions>();\n  @Output() loadImageFailed = new EventEmitter<void>();\n\n  constructor(\n    private cropService: CropService,\n    private cropperPositionService: CropperPositionService,\n    private loadImageService: LoadImageService,\n    private sanitizer: DomSanitizer,\n    private cd: ChangeDetectorRef\n  ) {\n    this.reset();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    this.onChangesUpdateSettings(changes);\n    this.onChangesInputImage(changes);\n\n    if (this.loadedImage && this.loadedImage.original.image.complete\n      && (changes.containWithinAspectRatio || changes.canvasRotation)) {\n      this.loadImageService\n        .transformLoadedImage(this.loadedImage, this.settings)\n        .then((res) => this.setLoadedImage(res))\n        .catch((err) => this.loadImageError(err));\n    }\n    if (changes.cropper || changes.maintainAspectRatio || changes.aspectRatio) {\n      this.setMaxSize();\n      this.setCropperScaledMinSize();\n      this.setCropperScaledMaxSize();\n      if (this.maintainAspectRatio && (changes.maintainAspectRatio || changes.aspectRatio)) {\n        this.resetCropperPosition();\n      } else if (changes.cropper) {\n        this.checkCropperPosition(false);\n        this.doAutoCrop();\n      }\n      this.cd.markForCheck();\n    }\n    if (changes.transform) {\n      this.transform = this.transform || {};\n      this.setCssTransform();\n      this.doAutoCrop();\n    }\n  }\n\n  private onChangesUpdateSettings(changes: SimpleChanges) {\n    this.settings.setOptionsFromChanges(changes);\n\n    if (this.settings.cropperStaticHeight && this.settings.cropperStaticWidth) {\n      this.settings.setOptions({\n        hideResizeSquares: true,\n        cropperMinWidth: this.settings.cropperStaticWidth,\n        cropperMinHeight: this.settings.cropperStaticHeight,\n        cropperMaxHeight: this.settings.cropperStaticHeight,\n        cropperMaxWidth: this.settings.cropperStaticWidth,\n        maintainAspectRatio: false\n      });\n    }\n  }\n\n  private onChangesInputImage(changes: SimpleChanges): void {\n    if (changes.imageChangedEvent || changes.imageURL || changes.imageBase64 || changes.imageFile) {\n      this.reset();\n    }\n    if (changes.imageChangedEvent && this.isValidImageChangedEvent()) {\n      this.loadImageFile(this.imageChangedEvent.target.files[0]);\n    }\n    if (changes.imageURL && this.imageURL) {\n      this.loadImageFromURL(this.imageURL);\n    }\n    if (changes.imageBase64 && this.imageBase64) {\n      this.loadBase64Image(this.imageBase64);\n    }\n    if (changes.imageFile && this.imageFile) {\n      this.loadImageFile(this.imageFile);\n    }\n  }\n\n  private isValidImageChangedEvent(): boolean {\n    return this.imageChangedEvent\n      && this.imageChangedEvent.target\n      && this.imageChangedEvent.target.files\n      && this.imageChangedEvent.target.files.length > 0;\n  }\n\n  private setCssTransform() {\n    this.safeTransformStyle = this.sanitizer.bypassSecurityTrustStyle(\n      'scaleX(' + (this.transform.scale || 1) * (this.transform.flipH ? -1 : 1) + ')' +\n      'scaleY(' + (this.transform.scale || 1) * (this.transform.flipV ? -1 : 1) + ')' +\n      'rotate(' + (this.transform.rotate || 0) + 'deg)'\n    );\n  }\n\n  ngOnInit(): void {\n    this.settings.stepSize = this.initialStepSize;\n    this.activatePinchGesture();\n  }\n\n  private reset(): void {\n    this.imageVisible = false;\n    this.loadedImage = null;\n    this.safeImgDataUrl = 'data:image/png;base64,iVBORw0KGg'\n      + 'oAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAU'\n      + 'AAarVyFEAAAAASUVORK5CYII=';\n    this.moveStart = {\n      active: false,\n      type: null,\n      position: null,\n      x1: 0,\n      y1: 0,\n      x2: 0,\n      y2: 0,\n      clientX: 0,\n      clientY: 0\n    };\n    this.maxSize = {\n      width: 0,\n      height: 0\n    };\n    this.cropper.x1 = -100;\n    this.cropper.y1 = -100;\n    this.cropper.x2 = 10000;\n    this.cropper.y2 = 10000;\n  }\n\n  private loadImageFile(file: File): void {\n    this.loadImageService\n      .loadImageFile(file, this.settings)\n      .then((res) => this.setLoadedImage(res))\n      .catch((err) => this.loadImageError(err));\n  }\n\n  private loadBase64Image(imageBase64: string): void {\n    this.loadImageService\n      .loadBase64Image(imageBase64, this.settings)\n      .then((res) => this.setLoadedImage(res))\n      .catch((err) => this.loadImageError(err));\n  }\n\n  private loadImageFromURL(url: string): void {\n    this.loadImageService\n      .loadImageFromURL(url, this.settings)\n      .then((res) => this.setLoadedImage(res))\n      .catch((err) => this.loadImageError(err));\n  }\n\n  private setLoadedImage(loadedImage: LoadedImage): void {\n    this.loadedImage = loadedImage;\n    this.safeImgDataUrl = this.sanitizer.bypassSecurityTrustResourceUrl(loadedImage.transformed.base64);\n    this.cd.markForCheck();\n  }\n\n  private loadImageError(error: any): void {\n    console.error(error);\n    this.loadImageFailed.emit();\n  }\n\n  imageLoadedInView(): void {\n    if (this.loadedImage != null) {\n      this.imageLoaded.emit(this.loadedImage);\n      this.setImageMaxSizeRetries = 0;\n      setTimeout(() => this.checkImageMaxSizeRecursively());\n    }\n  }\n\n  private checkImageMaxSizeRecursively(): void {\n    if (this.setImageMaxSizeRetries > 40) {\n      this.loadImageFailed.emit();\n    } else if (this.sourceImageLoaded()) {\n      this.setMaxSize();\n      this.setCropperScaledMinSize();\n      this.setCropperScaledMaxSize();\n      this.resetCropperPosition();\n      this.cropperReady.emit({...this.maxSize});\n      this.cd.markForCheck();\n    } else {\n      this.setImageMaxSizeRetries++;\n      setTimeout(() => this.checkImageMaxSizeRecursively(), 50);\n    }\n  }\n\n  private sourceImageLoaded(): boolean {\n    return this.sourceImage && this.sourceImage.nativeElement && this.sourceImage.nativeElement.offsetWidth > 0;\n  }\n\n  @HostListener('window:resize')\n  onResize(): void {\n    if (!this.loadedImage) {\n      return;\n    }\n    this.resizeCropperPosition();\n    this.setMaxSize();\n    this.setCropperScaledMinSize();\n    this.setCropperScaledMaxSize();\n  }\n\n  private activatePinchGesture() {\n    if (this.Hammer) {\n      const hammer = new this.Hammer(this.wrapper.nativeElement);\n      hammer.get('pinch').set({enable: true});\n      hammer.on('pinchmove', this.onPinch.bind(this));\n      hammer.on('pinchend', this.pinchStop.bind(this));\n      hammer.on('pinchstart', this.startPinch.bind(this));\n    } else if (isDevMode()) {\n      console.warn('[NgxImageCropper] Could not find HammerJS - Pinch Gesture won\\'t work');\n    }\n  }\n\n  private resizeCropperPosition(): void {\n    const sourceImageElement = this.sourceImage.nativeElement;\n    if (this.maxSize.width !== sourceImageElement.offsetWidth || this.maxSize.height !== sourceImageElement.offsetHeight) {\n      this.cropper.x1 = this.cropper.x1 * sourceImageElement.offsetWidth / this.maxSize.width;\n      this.cropper.x2 = this.cropper.x2 * sourceImageElement.offsetWidth / this.maxSize.width;\n      this.cropper.y1 = this.cropper.y1 * sourceImageElement.offsetHeight / this.maxSize.height;\n      this.cropper.y2 = this.cropper.y2 * sourceImageElement.offsetHeight / this.maxSize.height;\n    }\n  }\n\n  resetCropperPosition(): void {\n    this.cropperPositionService.resetCropperPosition(this.sourceImage, this.cropper, this.settings);\n    this.doAutoCrop();\n    this.imageVisible = true;\n  }\n\n  keyboardAccess(event: any) {\n    this.changeKeyboardStepSize(event);\n    this.keyboardMoveCropper(event);\n  }\n\n  private changeKeyboardStepSize(event: any): void {\n    if (event.key >= '1' && event.key <= '9') {\n      this.settings.stepSize = +event.key;\n      return;\n    }\n  }\n\n  private keyboardMoveCropper(event) {\n    const keyboardWhiteList: string[] = ['ArrowUp', 'ArrowDown', 'ArrowRight', 'ArrowLeft'];\n    if (!(keyboardWhiteList.includes(event.key))) {\n      return;\n    }\n    const moveType = event.shiftKey ? MoveTypes.Resize : MoveTypes.Move;\n    const position = event.altKey ? getInvertedPositionForKey(event.key) : getPositionForKey(event.key);\n    const moveEvent = getEventForKey(event.key, this.settings.stepSize);\n    event.preventDefault();\n    event.stopPropagation();\n    this.startMove({clientX: 0, clientY: 0}, moveType, position);\n    this.moveImg(moveEvent);\n    this.moveStop();\n  }\n\n  startMove(event: any, moveType: MoveTypes, position: string | null = null): void {\n    if (this.moveStart && this.moveStart.active && this.moveStart.type === MoveTypes.Pinch) {\n      return;\n    }\n    if (event.preventDefault) {\n      event.preventDefault();\n    }\n    this.moveStart = {\n      active: true,\n      type: moveType,\n      position,\n      clientX: this.cropperPositionService.getClientX(event),\n      clientY: this.cropperPositionService.getClientY(event),\n      ...this.cropper\n    };\n  }\n\n  startPinch(event: any) {\n    if (!this.safeImgDataUrl) {\n      return;\n    }\n    if (event.preventDefault) {\n      event.preventDefault();\n    }\n    this.moveStart = {\n      active: true,\n      type: MoveTypes.Pinch,\n      position: 'center',\n      clientX: this.cropper.x1 + (this.cropper.x2 - this.cropper.x1) / 2,\n      clientY: this.cropper.y1 + (this.cropper.y2 - this.cropper.y1) / 2,\n      ...this.cropper\n    };\n  }\n\n  @HostListener('document:mousemove', ['$event'])\n  @HostListener('document:touchmove', ['$event'])\n  moveImg(event: any): void {\n    if (this.moveStart.active) {\n      if (event.stopPropagation) {\n        event.stopPropagation();\n      }\n      if (event.preventDefault) {\n        event.preventDefault();\n      }\n      if (this.moveStart.type === MoveTypes.Move) {\n        this.cropperPositionService.move(event, this.moveStart, this.cropper);\n        this.checkCropperPosition(true);\n      } else if (this.moveStart.type === MoveTypes.Resize) {\n        if (!this.cropperStaticWidth && !this.cropperStaticHeight) {\n          this.cropperPositionService.resize(event, this.moveStart, this.cropper, this.maxSize, this.settings);\n        }\n        this.checkCropperPosition(false);\n      }\n      this.cd.detectChanges();\n    }\n  }\n\n  onPinch(event: any) {\n    if (this.moveStart.active) {\n      if (event.stopPropagation) {\n        event.stopPropagation();\n      }\n      if (event.preventDefault) {\n        event.preventDefault();\n      }\n      if (this.moveStart.type === MoveTypes.Pinch) {\n        this.cropperPositionService.resize(event, this.moveStart, this.cropper, this.maxSize, this.settings);\n        this.checkCropperPosition(false);\n      }\n      this.cd.detectChanges();\n    }\n  }\n\n  private setMaxSize(): void {\n    if (this.sourceImage) {\n      const sourceImageElement = this.sourceImage.nativeElement;\n      this.maxSize.width = sourceImageElement.offsetWidth;\n      this.maxSize.height = sourceImageElement.offsetHeight;\n      this.marginLeft = this.sanitizer.bypassSecurityTrustStyle('calc(50% - ' + this.maxSize.width / 2 + 'px)');\n    }\n  }\n\n  private setCropperScaledMinSize(): void {\n    if (this.loadedImage && this.loadedImage.transformed && this.loadedImage.transformed.image) {\n      this.setCropperScaledMinWidth();\n      this.setCropperScaledMinHeight();\n    } else {\n      this.settings.cropperScaledMinWidth = 20;\n      this.settings.cropperScaledMinHeight = 20;\n    }\n  }\n\n  private setCropperScaledMinWidth(): void {\n    this.settings.cropperScaledMinWidth = this.cropperMinWidth > 0\n      ? Math.max(20, this.cropperMinWidth / this.loadedImage.transformed.image.width * this.maxSize.width)\n      : 20;\n  }\n\n  private setCropperScaledMinHeight(): void {\n    if (this.maintainAspectRatio) {\n      this.settings.cropperScaledMinHeight = Math.max(20, this.settings.cropperScaledMinWidth / this.aspectRatio);\n    } else if (this.cropperMinHeight > 0) {\n      this.settings.cropperScaledMinHeight = Math.max(\n        20,\n        this.cropperMinHeight / this.loadedImage.transformed.image.height * this.maxSize.height\n      );\n    } else {\n      this.settings.cropperScaledMinHeight = 20;\n    }\n  }\n\n  private setCropperScaledMaxSize(): void {\n    if (this.loadedImage && this.loadedImage.transformed && this.loadedImage.transformed.image) {\n      const ratio = this.loadedImage.transformed.size.width / this.maxSize.width;\n      this.settings.cropperScaledMaxWidth = this.cropperMaxWidth > 20 ? this.cropperMaxWidth / ratio : this.maxSize.width;\n      this.settings.cropperScaledMaxHeight = this.cropperMaxHeight > 20 ? this.cropperMaxHeight / ratio : this.maxSize.height;\n      if (this.maintainAspectRatio) {\n        if (this.settings.cropperScaledMaxWidth > this.settings.cropperScaledMaxHeight * this.aspectRatio) {\n          this.settings.cropperScaledMaxWidth = this.settings.cropperScaledMaxHeight * this.aspectRatio;\n        } else if (this.settings.cropperScaledMaxWidth < this.settings.cropperScaledMaxHeight * this.aspectRatio) {\n          this.settings.cropperScaledMaxHeight = this.settings.cropperScaledMaxWidth / this.aspectRatio;\n        }\n      }\n    } else {\n      this.settings.cropperScaledMaxWidth = this.maxSize.width;\n      this.settings.cropperScaledMaxHeight = this.maxSize.height;\n    }\n  }\n\n  private checkCropperPosition(maintainSize = false): void {\n    if (this.cropper.x1 < 0) {\n      this.cropper.x2 -= maintainSize ? this.cropper.x1 : 0;\n      this.cropper.x1 = 0;\n    }\n    if (this.cropper.y1 < 0) {\n      this.cropper.y2 -= maintainSize ? this.cropper.y1 : 0;\n      this.cropper.y1 = 0;\n    }\n    if (this.cropper.x2 > this.maxSize.width) {\n      this.cropper.x1 -= maintainSize ? (this.cropper.x2 - this.maxSize.width) : 0;\n      this.cropper.x2 = this.maxSize.width;\n    }\n    if (this.cropper.y2 > this.maxSize.height) {\n      this.cropper.y1 -= maintainSize ? (this.cropper.y2 - this.maxSize.height) : 0;\n      this.cropper.y2 = this.maxSize.height;\n    }\n  }\n\n  @HostListener('document:mouseup')\n  @HostListener('document:touchend')\n  moveStop(): void {\n    if (this.moveStart.active) {\n      this.moveStart.active = false;\n      this.doAutoCrop();\n    }\n  }\n\n  pinchStop(): void {\n    if (this.moveStart.active) {\n      this.moveStart.active = false;\n      this.doAutoCrop();\n    }\n  }\n\n  private doAutoCrop(): void {\n    if (this.autoCrop) {\n      this.crop();\n    }\n  }\n\n  crop(): ImageCroppedEvent | null {\n    if (this.sourceImage && this.sourceImage.nativeElement && this.loadedImage.transformed.image != null) {\n      this.startCropImage.emit();\n      const output = this.cropService.crop(this.sourceImage, this.loadedImage, this.cropper, this.settings);\n      if (output != null) {\n        this.imageCropped.emit(output);\n      }\n      return output;\n    }\n    return null;\n  }\n}\n","export function getPositionForKey(key: string): string {\n  switch (key) {\n    case 'ArrowUp':\n      return 'top';\n    case 'ArrowRight':\n      return 'right';\n    case 'ArrowDown':\n      return 'bottom';\n    case 'ArrowLeft':\n    default:\n      return 'left';\n  }\n}\n\nexport function getInvertedPositionForKey(key: string): string {\n  switch (key) {\n    case 'ArrowUp':\n      return 'bottom';\n    case 'ArrowRight':\n      return 'left';\n    case 'ArrowDown':\n      return 'top';\n    case 'ArrowLeft':\n    default:\n      return 'right';\n  }\n}\n\nexport function getEventForKey(key: string, stepSize: number): any {\n  switch (key) {\n    case 'ArrowUp':\n      return {clientX: 0, clientY: stepSize * -1};\n    case 'ArrowRight':\n      return {clientX: stepSize, clientY: 0};\n    case 'ArrowDown':\n      return {clientX: 0, clientY: stepSize};\n    case 'ArrowLeft':\n    default:\n      return {clientX: stepSize * -1, clientY: 0};\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ImageCropperComponent } from './component/image-cropper.component';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  declarations: [\n    ImageCropperComponent\n  ],\n  exports: [\n    ImageCropperComponent\n  ]\n})\nexport class ImageCropperModule {\n}\n","export function base64ToFile(base64Image: string): Blob {\n  const split = base64Image.split(',');\n  const type = split[0].replace('data:', '').replace(';base64', '');\n  const byteString = atob(split[1]);\n  const ab = new ArrayBuffer(byteString.length);\n  const ia = new Uint8Array(ab);\n  for (let i = 0; i < byteString.length; i += 1) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n  return new Blob([ab], {type});\n}\n"]}